<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Software Development Ramblings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/pure-min.css" type="text/css">
  <link rel="stylesheet" href="/css/biture.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header">
    <div class="wrap">
  <div class="inner">
    <a class="brand" href="/">Software Development Ramblings</a>
    <a id="menu-toggle" href="#"><i class="fa fa-bars"></i></a>
<ul class="nav-menu">

</ul>

<ul class="nav-menu ext-menu">


    <li><a href="//github.com/pbuda/">github</a></li>



    <li><a href="//twitter.com/piotrbuda">twitter</a></li>



    <li><a href="//pl.linkedin.com/in/piotrbuda">linked-in</a></li>


  <li><a class="various" href="#fbox-tagcloud">tags</a></li>
</ul>
</div>

  </div>
</div>

<div class="tagcloud" id="fbox-tagcloud" style="margin:10px; display:none; overflow: hidden"><a href="/tags/actors/" style="font-size: 12px;">actors</a><a href="/tags/api/" style="font-size: 12px;">api</a><a href="/tags/capabilities/" style="font-size: 24px;">capabilities</a><a href="/tags/cloud/" style="font-size: 12px;">cloud</a><a href="/tags/concurrency/" style="font-size: 24px;">concurrency</a><a href="/tags/defaults/" style="font-size: 12px;">defaults</a><a href="/tags/google-play/" style="font-size: 12px;">google play</a><a href="/tags/openshift/" style="font-size: 12px;">openshift</a><a href="/tags/play/" style="font-size: 12px;">play</a><a href="/tags/play-store-api/" style="font-size: 12px;">play store api</a><a href="/tags/pony/" style="font-size: 12px;">pony</a><a href="/tags/pony-lang/" style="font-size: 12px;">pony lang</a><a href="/tags/sbt/" style="font-size: 12px;">sbt</a><a href="/tags/scala/" style="font-size: 24px;">scala</a><a href="/tags/spray/" style="font-size: 12px;">spray</a><a href="/tags/store/" style="font-size: 12px;">store</a><a href="/tags/websocket/" style="font-size: 12px;">websocket</a></div>

  </header>
  <div id="main-content" class="wrap">
  <div class="inner">
    
  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-10-28T18:23:00.000Z">
        <div class="day">28</div>
        <div class="month">Oct 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/10/scala-case-classes-and-annotations-part-1.html">Scala case classes and annotations, part 1</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>Recently in Twittory I moved from Java to Scala. Well, to be honest I just switched from Java to Scala syntax and will move on to adapt to functional programming principles.</p>
<p>There was one glitch during the process. I am using Spring Data for MongoDb and to ease up a few queries I used statics to define field names of objects I store.</p>
<p>Here’s an example: very simple class that I use to store tweet scanning bookmarks:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanningBookmark</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER_ID = <span class="string">"userId"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String STATUS_ID = <span class="string">"statusId"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ScanningBookmark</span><span class="params">(<span class="keyword">long</span> userId, <span class="keyword">long</span> statusId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">        <span class="keyword">this</span>.statusId = statusId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Field</span>(USER_ID)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> userId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Field</span>(STATUS_ID)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> statusId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getStatusId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> statusId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Storing this thing with Spring Data. The static fields defining field names are here so that somewhere else I can define a query using those fields. The @Field annotations allow customization of field names in collections and while here they are the same as actual field names, they could be set differently.</p>
<p>Now when I was rewriting this to Scala, it’s quite obvious I ended up with a case class.<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanningBookmark</span>(</span>userId: <span class="type">Long</span>, statusId: <span class="type">Long</span>)</span><br></pre></td></tr></table></figure><br>But the problem with case class is that adding @Field annotations doesn’t work anymore. This is because writing like this:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanningBookmark</span>(</span><span class="annotation">@Field</span>(<span class="string">"userId"</span>) userId: <span class="type">Long</span>,</span><br><span class="line">                            <span class="annotation">@Field</span>(<span class="string">"statusId"</span>) statusId: <span class="type">Long</span>)</span><br></pre></td></tr></table></figure><br>places the @Field annotation on constructor arguments, fields and Scala accessors which probably makes Spring Data scanner fail. The result is that these fields are no longer customizable and I wanted to somehow remedy that.</p>
<p>Playing with @BeanProperty annotation didn’t solve the problem because apparently the @Field annotation is then also placed on generated accessors. But solution to this problem is actually quite easy. In Scala there are target meta-annotations that can be put on the annotation type when instantiating the annotation. There are six of those: @beanGetter, @beanSetter, @field, @getter, @setter, @param. Consult the <a href="http://www.scala-lang.org/api/2.9.2/scala/annotation/target/package.html" target="_blank" rel="external">target package</a> for more info.</p>
<p>The solution? It’s very simple:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanningBookmark</span>(</span>@(<span class="type">Field</span><span class="annotation">@field</span>)(<span class="string">"userId2"</span>) userId: <span class="type">Long</span>, </span><br><span class="line">                            @(<span class="type">Field</span><span class="annotation">@field</span>)(<span class="string">"statusId2"</span>) statusId: <span class="type">Long</span>)</span><br></pre></td></tr></table></figure><br>And that’s it! But there’s one last thing to make it behave like Java version. In Java I used statics to define field values (so that there’s no problem when some name changes). So I want something like this:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanningBookmark</span>(</span>@(<span class="type">Field</span><span class="annotation">@field</span>)(<span class="type">USER_ID</span>) userId: <span class="type">Long</span>, </span><br><span class="line">                            @(<span class="type">Field</span><span class="annotation">@field</span>)(<span class="type">STATUS_ID</span>) statusId: <span class="type">Long</span>) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">val</span> <span class="title">USER_ID</span>:</span> <span class="type">String</span> = <span class="string">"userId2"</span></span><br><span class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">val</span> <span class="title">STATUS_ID</span>:</span> <span class="type">String</span> = <span class="string">"statusId2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>But this is not how things work in Scala and it took a while to learn that :) But this is for another short post.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-09-25T14:02:00.000Z">
        <div class="day">25</div>
        <div class="month">Sep 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/09/function-programming-principles-in-scala-course-week-one.html">Function Programming Principles in Scala course - week one</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>So the course started a week ago and I’d like to share my opinion after the first week.</p>
<p>First of all I got this feeling that most people attending the course thought that it’ll be a Scala course. While Scala is used to demonstrate functional programming principles it is not a Scala course. You have to know Scala on your own, however for now Martin Odersky does explain it’s syntax. If you’re into learning Scala only, this is not a course for you IMO.</p>
<p>Lectures are recorded with good quality and Martin’s English is very good, he also speaks slowly. This is OK for people who have problems with understanding English and for those who don’t, you can increase video speed to 1.25x or even 1.5x and it’s still quite easy to understand what he’s saying.</p>
<p>Since it’s my first Coursera course, I was surprised with the first quiz during a lecture :) but these are nice little stops for you to think. Sometimes you have to check a proper answer and sometimes you are only asked to do something on your own.</p>
<p>As for assignments, they are pretty clear. You have to do a thing or two and submit your solutions. Altough there are tests written for you already, the very first thing that I did for the first assignment was adding a few tests for corner cases. Later on things were smoothly as the assignments were not that hard.</p>
<p>I’ve had a few problems with the countChange function but mainly because I made some wrong assumptions (thanks go to <a href="https://twitter.com/marcinderylo" target="_blank" rel="external">@marcinderylo</a> for pointing that out to me). I didn’t use Eclipse or Intellij Idea for the first assignment - I used vim and just set tests to run continously in sbt. For the next week I plan to use Intellij, however the course is setup using Eclipse (it’s probably easier to do, since Scala plugin for Intellij is like alpha stage).</p>
<p>And that’s it. This is the first ‘real’ learning since I finished university, but this time it’s for the good cause :) I hope everyone enjoys the course and I really hope that my skills in functional programming will benefit from the it.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-09-14T09:40:00.000Z">
        <div class="day">14</div>
        <div class="month">Sep 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/09/twittory-lessons-learned-dont-mock-iterator.html">Twittory lessons learned - don&#39;t mock Iterator</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p><del>So I’m doing this pet project now called <a href="https://github.com/pbuda/twittory" target="_blank" rel="external">Twittory</a> and because it’s hosted on Github, people can review it and voice their oppinions.</del><strong>Update (03 Feb 2013): I no longer develop this project.</strong></p>
<p>Marcin Deryło (<a href="https://twitter.com/marcinderylo" target="_blank" rel="external">twitter</a>, <a href="http://marcinderylo.blogspot.com/" target="_blank" rel="external">blog</a>), a friend of mine, has recently reviewed some simple tests already present in the project and he raised an issue with mocking iterators.</p>
<p>I’ve had a very simple method which iterated over a collection returned by Twitter4J API. To do that, I simply mocked an Iterator and it’s hasNext() and next() methods (using Mockito it’s really simple anyway):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returns_details_only_for_tweets_with_links</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Status status1 = prepareStatus(<span class="string">"Status 1"</span>);</span><br><span class="line">    Status status2 = prepareStatus(<span class="string">"Text with link http://www.onet.pl in it"</span>);</span><br><span class="line">    Status status3 = prepareStatus(<span class="string">"Status 3"</span>);</span><br><span class="line">    ResponseList&lt;Status&gt; mockResponse = mock(ResponseList.class);</span><br><span class="line">    Iterator mockIterator = mock(Iterator.class);</span><br><span class="line"></span><br><span class="line">    when(mockIterator.hasNext()).thenReturn(<span class="keyword">true</span>).thenReturn(<span class="keyword">true</span>).thenReturn(<span class="keyword">true</span>).thenReturn(<span class="keyword">false</span>);</span><br><span class="line">    when(mockIterator.next()).thenReturn(status1).thenReturn(status2).thenReturn(status3);</span><br><span class="line">    when(mockResponse.iterator()).thenReturn(mockIterator);</span><br><span class="line">    when(twitter.getHomeTimeline()).thenReturn(mockResponse);</span><br><span class="line"></span><br><span class="line">    List&lt;LinkDetails&gt; scan = scanner.scan();</span><br><span class="line">    assertNotNull(scan);</span><br><span class="line">    assertEquals(<span class="number">1</span>, scan.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>But said friend of mine suggested to drop mocking here in favor of actually returning a real iterator:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returns_details_only_for_tweets_with_links</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Status status1 = prepareStatus(<span class="string">"Status 1"</span>);</span><br><span class="line">    Status status2 = prepareStatus(<span class="string">"Text with link http://www.onet.pl in it"</span>);</span><br><span class="line">    Status status3 = prepareStatus(<span class="string">"Status 3"</span>);</span><br><span class="line">    ResponseList&lt;Status&gt; mockResponse = mock(ResponseList.class);</span><br><span class="line"></span><br><span class="line">    when(mockResponse.iterator()).thenReturn(Arrays.asList(status1, status2, status3).iterator());</span><br><span class="line">    when(twitter.getHomeTimeline()).thenReturn(mockResponse);</span><br><span class="line"></span><br><span class="line">    List&lt;LinkDetails&gt; scan = scanner.scan();</span><br><span class="line">    assertNotNull(scan);</span><br><span class="line">    assertEquals(<span class="number">1</span>, scan.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Pretty slick, eh? Saves code and complexity while becoming much more readable at the same time.</p>
<p>Learning FTW.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-08-06T11:37:00.000Z">
        <div class="day">6</div>
        <div class="month">Aug 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/08/gitflow-intellij-idea-plugin.html">GitFlow Intellij Idea plugin</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>I am creating a few side projects currently and I use git-flow Git extension for each of them, but I lack the support from Intellij Idea in this regard – mainly the starting and stopping of features and releases.</p>
<p>So because of that I’ve started a small project to include said functionality in Idea. It’s nothing major as apparently Jetbrains will include such plugin in some version of Intellij, but I need it now and I’m interested in how to write plugins for Idea<br>What will the plugin be able to do?</p>
<p>git flow init -d<br>git flow feature start/finish<br>git flow release start/finish<br>The first version I will release will be able to do 1 and 2 while option 3 will be available at some later time. But I don’t know yet when I will release it, so stay tuned if you’re interested.</p>
<p>The project is of course at <a href="https://github.com/pbuda/gitflowidea" target="_blank" rel="external">GitHub</a></p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-07-23T09:59:00.000Z">
        <div class="day">23</div>
        <div class="month">Jul 2012</div>
      </time></div>
      <div class="article-tags">
        
  
    <a href='/tags/api/' class='pure-button pull-right' style='margin:3px;'>api</a>
  
    <a href='/tags/google-play/' class='pure-button pull-right' style='margin:3px;'>google play</a>
  
    <a href='/tags/play/' class='pure-button pull-right' style='margin:3px;'>play</a>
  
    <a href='/tags/play-store-api/' class='pure-button pull-right' style='margin:3px;'>play store api</a>
  
    <a href='/tags/store/' class='pure-button pull-right' style='margin:3px;'>store</a>
  


      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/07/play-store-api-on-github-dot-com.html">Play Store API on GitHub.com</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p><strong>[Update 2013-05-14] I will no longer keep this project on my GitHub, I didn’t have time to play with it and most likely this is already obsolete API. It has been removed.</strong></p>
<p><del>If anyone is interested, I mirrored a great project: <a href="http://code.google.com/p/android-market-api/" target="_blank" rel="external">Android Market API</a> and it’s now available <a href="https://github.com/pbuda/playstoreapi" target="_blank" rel="external">on GitHub.com</a>. I am using this API for my yet-to-be announced Android project and because of lack of support from original authors I decided to mirror it and introduce fixes/new features.</del></p>
<p><del>Currently I’m reworking the API of the project, but for now you can download the sources and build with Maven OR download the jar directly from project downloads section.</del></p>
<p><del>However, please notice that I focus on making this library work well on Android devices because in order to work properly it requires actual Android device capable of running Play Store.</del></p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-06-26T09:30:00.000Z">
        <div class="day">26</div>
        <div class="month">Jun 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/06/play-store-on-emulator-and-morals.html">Play Store on Emulator and morals</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>I’ve recently noticed that I have some traffic to my blog from <a href="http://stackoverflow.com/questions/11154222/google-play-in-android-4-0-emulator" target="_blank" rel="external">some question posted on Stack Overflow</a>. I checked out the question out of curiosity and what I found made me wonder, particularly <a href="http://stackoverflow.com/a/11155703/840794" target="_blank" rel="external">this answer</a>. I don’t have enough rep to comment on other answers, so I decided to rant here a little.</p>
<p>I understand that Google doesn’t want their Play Store available on devices that are not licensed, I don’t pretend to know why, I can only guess. But I don’t want to be called a software pirate. I did not rip Play Store from a device nor I distribute it. The Play Store apk that I used comes from CyanogenMod page, AFAIK the Google apps package for CM is the only way for their users to update Google apps. Is this also pirating?  If so, we have SO MANY pirates in Android world then! There are more than <a href="http://stats.cyanogenmod.com/" target="_blank" rel="external">one million CM users</a> out there so that means more than one million people pirate Play Store. Not to mention some Kindle Fire users who install Play Store on their rooted devices.</p>
<p>I am no lawyer, but after reading Google Play EULA several times, I don’t find any point that prohibits me from installing it on emulator. Now Google did make an attempt to limit Play Store use on emulator (even if not on purpose) by using DRM protection which makes Google Play not work on emulator anyway - <a href="http://www.piotrbuda.eu/2012/06/trying-to-solve-error-491-in-play-store.html" target="_blank" rel="external">you can’t download apps!</a></p>
<p>Rant over, I just needed to vent.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-06-26T07:23:00.000Z">
        <div class="day">26</div>
        <div class="month">Jun 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/06/trying-to-solve-error-491-in-play-store-on-android-emulator.html">Trying to solve Error 491 in Play Store on Android Emulator</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>Installing Google Play Store on Android emulator is quite easy - I described it in my <a href="/2012/05/installing-google-play-on-android-emulator.html">previous article</a>. However there is one problem that does not allow downloading of apps - the dreadful Error 491.<br>After some investigation it appears that the error happens because Android emulator does not have DRM! This is the exact error that is displayed in Logcat:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">06</span>-<span class="number">25</span> <span class="number">07</span>:<span class="number">51</span>:<span class="number">42.142</span>: WARN/<span class="function"><span class="title">DownloadManager</span><span class="params">(<span class="number">342</span>)</span></span>: Exception <span class="keyword">for</span> id <span class="number">7</span>: android/drm/DrmManagerClient</span><br><span class="line">        java<span class="class">.lang</span><span class="class">.NoClassDefFoundError</span>: android/drm/DrmManagerClient</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.DownloadDrmHelper</span><span class="class">.isDrmMimeType</span>(DownloadDrmHelper<span class="class">.java</span>:<span class="number">45</span>)</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.Helpers</span><span class="class">.checkCanHandleDownload</span>(Helpers<span class="class">.java</span>:<span class="number">148</span>)</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.Helpers</span><span class="class">.generateSaveFile</span>(Helpers<span class="class">.java</span>:<span class="number">81</span>)</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.DownloadThread</span><span class="class">.processResponseHeaders</span>(DownloadThread<span class="class">.java</span>:<span class="number">563</span>)</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.DownloadThread</span><span class="class">.executeDownload</span>(DownloadThread<span class="class">.java</span>:<span class="number">256</span>)</span><br><span class="line">        at com<span class="class">.android</span><span class="class">.providers</span><span class="class">.downloads</span><span class="class">.DownloadThread</span><span class="class">.run</span>(DownloadThread<span class="class">.java</span>:<span class="number">172</span>)</span><br></pre></td></tr></table></figure>
<p>I’ve tried a few things to fix this, but nothing really helped. The CyanogenMod Google Apps package contained some DRM jar, but it didn’t help at all. So I’ve decided to browse my Galaxy S2 and found this <em>/system/app/DrmProvider.apk</em> which I thought might help. So I pulled it from device and pushed it to the emulator. As expected, it kind of worked, but it now threw another exception:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">06</span>-<span class="number">25</span> <span class="number">07</span>:<span class="number">53</span>:<span class="number">52.043</span>: WARN/DownloadManager(<span class="number">724</span>): Exception <span class="keyword">for</span> id <span class="number">8</span>: <span class="literal">null</span></span><br><span class="line">        java.lang.ExceptionInInitializerError</span><br><span class="line">        at com.android.providers.downloads.DownloadDrmHelper.isDrmMimeType(DownloadDrmHelper.<span class="string">java:</span><span class="number">45</span>)</span><br><span class="line">        at com.android.providers.downloads.Helpers.checkCanHandleDownload(Helpers.<span class="string">java:</span><span class="number">148</span>)</span><br><span class="line">        at com.android.providers.downloads.Helpers.generateSaveFile(Helpers.<span class="string">java:</span><span class="number">81</span>)</span><br><span class="line">        at com.android.providers.downloads.DownloadThread.processResponseHeaders(DownloadThread.<span class="string">java:</span><span class="number">563</span>)</span><br><span class="line">        at com.android.providers.downloads.DownloadThread.executeDownload(DownloadThread.<span class="string">java:</span><span class="number">256</span>)</span><br><span class="line">        at com.android.providers.downloads.DownloadThread.run(DownloadThread.<span class="string">java:</span><span class="number">172</span>)</span><br><span class="line">        Caused <span class="string">by:</span> java.lang.<span class="string">UnsatisfiedLinkError:</span> Library drmframework_jni not found; tried [<span class="regexp">/vendor/</span>lib<span class="regexp">/libdrmframework_jni.so, /</span>system<span class="regexp">/lib/</span>libdrmframework_jni.so]</span><br><span class="line">        at java.lang.Runtime.loadLibrary(Runtime.<span class="string">java:</span><span class="number">393</span>)</span><br><span class="line">        at java.lang.System.loadLibrary(System.<span class="string">java:</span><span class="number">535</span>)</span><br><span class="line">        at android.drm.DrmManagerClient.&lt;clinit&gt;(DrmManagerClient.<span class="string">java:</span><span class="number">56</span>)</span><br><span class="line">        ... <span class="number">6</span> more</span><br></pre></td></tr></table></figure>
<p>So I dig deeper and tried extracting missing .so files. Browsing my phone revealed four files that I might be interested in: <em>libdrm1.so</em>, <em>libdrm1_jni.so</em>, <em>libdrmframework.so</em> and <em>libdrmframework_jni.so</em>. Again, pulled those from device and pushed to emulator but I got the first exception and got stuck.</p>
<p>At this point I don’t have any more ideas how to solve this problem, but I will still try. It appears that installing DRM on emulator might be much more problematic than pulling some apks from real devices.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-05-02T19:40:00.000Z">
        <div class="day">2</div>
        <div class="month">May 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/05/installing-google-play-on-android-emulator.html">Installing Google Play on Android Emulator</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <h3 id="The_problem">The problem</h3><p>I wanted to install Google Play on emulator. Problem is no guide on the net could tell me precisely how to do this. I’m not sure why, it seemed that they worked with old Android Market (pre version 3 era) or at least people shown some screenshots of that but I couldn’t make it work at home.</p>
<p>The difference was that I tried to install Google Play on an Ice Cream Sandwitch emulator (API level 15) and it always failed.</p>
<h3 id="First_attempts">First attempts</h3><p>I first found <a href="http://blog.varunkumar.me/2010/11/how-to-install-android-market-in-google.html" target="_blank" rel="external">this site</a>. I tried setting up everything from there but I just couldn’t make it work. Possible because their Vending.apk couldn’t start, I have no clue. Then I found <a href="http://www.tech-recipes.com/rx/10004/accessing-android-market-from-android-sdk/" target="_blank" rel="external">this site</a> and I somehow managed to install Vending.apk on emulator using this guide, but I couldn’t reproduce that.</p>
<p>One of the problems with those guides (which made me spend a lot of time on something useless) was that both these guides made me delete two files from AVD: cache.img and userdata-qemu.img. Why? Apparently when you wanted to restart emulator, these files were responsible for reinitialization of emulator to it’s starting state (like full wipe/factory reset). I tried and tried and I always ended up without my changes.</p>
<h3 id="New_Hope">New Hope</h3><p>After that I found that there is a snapshot option in AVD configuration window so I just checked it and finally I was able to see last state of emulator. Maybe it’s not perfect - it works like hibernation on your laptop - but it works and after a whole day of fight it was enough.</p>
<p>I then though why do I install some obsolete Vending.apk and GoogleServicesFramework.apk? Why can’t I have a new one there? So I connected my phone and pulled those apks from it. Of course it didn’t work, but I was not sure why. But I remembered something - <del>CyanogenMod has Google apps packed in a zip</del> (UPDATE: CyanogenMod does no longer host Google Apps, but you can <a href="http://goo.im/gapps/" target="_blank" rel="external">find them here</a>! So I downloaded their package and extracted everything I needed - Vending.apk and GoogleServicesFramework.apk. But it was not enough.</p>
<p>So I had an AVD set up with snapshots enabled and I proceeded to installing my new apks - full script will be posted at the end.</p>
<pre><code><span class="number">1.</span> You have <span class="keyword">to</span> remount system partition <span class="keyword">in</span> <span class="command">read</span>-<span class="command">write</span> mode.
<span class="number">2.</span> Then <span class="keyword">it</span>'s necessary <span class="keyword">to</span> allow writing <span class="keyword">to</span> /system/app directory
<span class="number">3.</span> After <span class="keyword">that</span> <span class="keyword">is</span> done just push apks <span class="keyword">to</span> /system/app/. (notice <span class="keyword">the</span> dot <span class="keyword">at</span> <span class="keyword">the</span> <span class="keyword">end</span>) 
<span class="number">4.</span> Just <span class="keyword">for</span> <span class="keyword">the</span> sake <span class="keyword">of</span> other guides I also remove /system/app/SdkSetup* (both apk <span class="keyword">and</span> odex)
</code></pre><p>Voila! Google Play is installed on emulator! But it still doesn’t work. In order for it to start working, you need an account - Google account. This step also cost me some time. My AVD was based on Android 4.0.3, not the Google APIs one. So I changed it and… still nothing.</p>
<p>Apparently in recent releases Google decided to decouple their account provider from the OS so they have a separate apk that allows configuration of Google accounts - it’s called GoogleLoginService.apk. Pushing this to emulator solved all the problems - you don’t even need Google APIs (you can set up against Android 4.0.3 option). Now when you enter Play Store you get prompted for an account and it works!</p>
<h3 id="Conclusion">Conclusion</h3><p>After two days of trying I finally was able to launch and browse Google Play Store on an Android emulator with Ice Cream Sandwitch. Phew.</p>
<p>Command I use to start my emulator<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">emulator</span> -avd am -partition-size <span class="number">200</span> -<span class="built_in">no</span>-audio -<span class="built_in">no</span>-boot-anim</span><br></pre></td></tr></table></figure><br>Full script (assumes you have created and started your AVD)<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb shell mount -o remount,rw -t yaffs2 /dev/block/mtdblock<span class="number">0</span> /<span class="keyword">system</span></span><br><span class="line">adb shell <span class="keyword">chmod</span> <span class="number">777</span> /<span class="keyword">system</span>/app</span><br><span class="line">adb <span class="keyword">push</span> GoogleLoginService.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb <span class="keyword">push</span> GoogleServicesFramework.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb <span class="keyword">push</span> Vending.apk /<span class="keyword">system</span>/app/.</span><br><span class="line">adb shell rm /<span class="keyword">system</span>/app/SdkSetup*</span><br></pre></td></tr></table></figure><br>That script will work as long as you run it from a dir in which you have all the necessary apks. Of course you have to have your PATH environment variable set correctly (so that all those commands are actually accessible) but I suppose you know that already.</p>
<h3 id="Settings_of_the_AVD">Settings of the AVD</h3><img src="/images/avdsettings.png" title="Settings of the AVD">
<h3 id="Working_Google_Play_Store">Working Google Play Store</h3><img src="/images/emulator.png" title="Working Google Play Store">
        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-04-30T22:18:00.000Z">
        <div class="day">1</div>
        <div class="month">May 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/05/getting-auth-token-on-an-android-device.html">Getting auth token on an Android device</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>I’m currently working on a little pet project that targets Android devices (well, at least my Galaxy) and requires auth token to operate. It wasn’t hard to find the code to do this: <a href="http://www.toxicbakery.com/android-development/getting-google-auth-sub-tokens-in-your-android-applications/comment-page-1/#comment-238" target="_blank" rel="external">Toxic Bakery has already shown how to do it.</a></p>
<p>My first attempt of using this code was successful and running on the device was easy - I simply added a button that invoked their method and it worked. However when I used this solution in my pet project it suddenly stopped working properly. The problem was happening when I was invalidating the auth token - recursive call would fail with IllegalStateException saying that calling that method on main thread would lead to a deadlock.</p>
<p>At first I didn’t know what to do - I am, after all, Android newbie. I spent some time trying to find out why my first code worked and second didn’t and I found a single difference - I used minSdkVersion in AndroidManifest.xml for my pet project. I have no idea why this happens, I don’t even know where to start looking. But I created a simple workaround to solve the problem - I used AsyncTask to create a background loader and it works very well now, not to mention I’ve had a good time reading about threading in Android.</p>
<p>The project with workaround can be found at <a href="https://github.com/piotrbudaeu/android-authtoken" target="_blank" rel="external">GitHub</a></p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>


  <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2012-04-11T10:01:00.000Z">
        <div class="day">11</div>
        <div class="month">Apr 2012</div>
      </time></div>
      <div class="article-tags">
        

      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title"><a href="/2012/04/commenting-the-code-is-obsolete.html">Commenting the code is obsolete</a></h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>Some time ago I had a few visits from fellow developers asking me questions about that I supposedly created. Since I obviously created some of that code months or years ago, I often couldn’t answer their questions because either my explanations were false (changed requirements) or I didn’t even know about that particular case (new code). It struck me that they came to me to ask these questions because I was placed as the author of the class in Javadoc…</p>
<p>More recently I’ve been in situation when our team leader told us that we’re not putting enough comments in our classes and the we could at least provide the @author Javadoc comment (or ASDoc in that case) so that everyone knows who to talk to about this code.</p>
<p>Revelation came to me sometime after that statement - why the hell do I need author information in a file?! I am checking in my code to a VCS which provides that information out of the box, moreover when the code changes it can report who changed the code! @author becomes meaningless after some time, VCS history does not - so use VCS instead.</p>
<p>This also applies to other comments (IMO). Instead of creating some code and heavily comment what it does (bad) I prefer to write smaller methods that tell what they’re doing (good). The only thing I think a comment is necessary for is method arguments, but I could also omit them when I call my arguments with meaningful names. This does not apply to function arguments, because I have to comment that function arguments. But that can also lead to something like this:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param callback function to call with signature </span><br><span class="line">*                 &lt;code&gt;function(arg1:String, arg2:Object):void&lt;/code&gt;</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span><span class="params">(callback:Function)</span><span class="type">:void</span> </span>&#123;</span><br><span class="line">  callback(arg1, arg2, arg3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Summary: instead of extensive comments, write better code and use tools that you’re given.</p>

        
      </div>
      <footer><div class="article-comment">
        

      </div></footer>
    </div>
  </div>
</article>



<div class="pure-g bitpager">
  <div class="pure-u-1-12"></div>
  <div class="pure-u-1-4">
    
    <a href="/">&larr; prev</a>
    
  </div>
  <div class="pure-u-5-12"></div>
  <div class="pure-u-1-4">
    
    <a href="/page/3/" class="pull-right">next &rarr;</a>
    
  </div>
</div>

  </div>
  </div>
  <footer id="footer">
    <div class="wrap">
  <div class="inner" style="text-align: center">
    
    &copy; 2015 Piotr Buda All Rights Reserved
    

    / <a href="https://github.com/kywk/hexo-theme-biture">biture</a> for <a href="http://zespia.tw/hexo/">hexo</a>
    / developed by <a href="http://kywk.github.io/moco/">MooCow (kywk)</a>.
  </div>
</div>

  </footer>
<!-- Le javascript -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-62603909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<!-- Responsive menu -->
<script>
$(document).ready(function() {
  $("#menu-toggle").click(function(event) {
    event.preventDefault();
    if ($(this).hasClass("isShow")) {
      $("#header").css({position: "fixed"});
      $("ul.nav-menu").hide();
      $(this).removeClass("isShow");
    } else {
      $("#header").css({position: "static"});
      $("ul.nav-menu").show();
      $("html, body").scrollTop(0);
      $(this).addClass("isShow");
    }
    return false;
  });

  $(window).resize(function() {
    if ($(window).width() > 700) {
      $("ul.nav-menu").removeAttr('style');
    }
  });

});
</script>



<script type="text/javascript">
var disqus_shortname = 'piotrbuda';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>




<link rel="stylesheet" href="/package/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/package/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript">
(function($){
  $(".fancybox").fancybox();
  $(".various").fancybox({
    maxWidth  : 800,
    maxHeight : 600,
    fitToView : false,
    width   : '70%',
    height    : '70%',
    autoSize  : true,
    closeClick  : false,
    openEffect  : 'none',
    closeEffect : 'none'
  });
})(jQuery);
</script>


</body>
</html>
